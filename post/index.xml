<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Posts on Stay True Stay Free</title>
    <link>http://www.staytruestayfree.com/post/index.xml</link>
    <description>Recent content in Posts on Stay True Stay Free</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Mon, 29 Jan 2018 20:55:56 +0800</lastBuildDate>
    <atom:link href="http://www.staytruestayfree.com/post/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>在VPS上搭建Istio环境</title>
      <link>http://www.staytruestayfree.com/post/deploy_istio_on_vps/</link>
      <pubDate>Mon, 29 Jan 2018 20:55:56 +0800</pubDate>
      
      <guid>http://www.staytruestayfree.com/post/deploy_istio_on_vps/</guid>
      <description>

&lt;h3 id=&#34;一-任务&#34;&gt;一、任务&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;使用kubeadm搭建一个1master+2slaves的kubernates集群&lt;/li&gt;
&lt;li&gt;于集群上部署Istio，运行其BookInfo示例&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;​&lt;/p&gt;

&lt;h3 id=&#34;二-准备&#34;&gt;二、准备&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;在Vultr上申请三台VPS，配置均为2 vCore，4G RAM。（实际搭建运行时性能无压力。）

&lt;ul&gt;
&lt;li&gt;需要注意的是，很多海外VPS的IP都被封掉了，ping不通。（可到站长之家之类的网站去确认，国内ping不通，海外可通。）对此可重建VPS直至获取可访问的IP，或者依赖科学上网的跳板机。&lt;/li&gt;
&lt;li&gt;另外，做验证只使用公网IP即可，无需使用数据中心的内网IP（当然实际的生产环境是使用内网IP的），甚至这三台VPS还可以是跨数据中心的，都可以搭建成功。&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;基本的知识依据为官网指南，按使用顺序依次为

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/setup/independent/install-kubeadm/&#34;&gt;安装kubeadm&lt;/a&gt; &lt;code&gt;注1&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/&#34;&gt;安装kubernates集群&lt;/a&gt;&lt;code&gt;注1&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/docs/setup/kubernetes/quick-start.html&#34;&gt;安装Istio&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/docs/guides/bookinfo.html&#34;&gt;安装BookInfo示例&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://istio.io/docs/tasks/traffic-management/ingress.html&#34;&gt;Istio Ingress Controller介绍&lt;/a&gt;的*Verifying ingress*部分&lt;code&gt;注2&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code&gt;注1&lt;/code&gt;：安装kubeadm和kubernates集群时，预想坑会比较多，还查阅了一些技术博客和官网对比了一下，但发现除了说明顺序不一样外（官网把很多细节放到Notes里），技术博客中提到的要点，在官网基本上都是有所体现。
  &lt;code&gt;注2&lt;/code&gt;：按说前4篇做完就应该结束了，但存在一个问题：Istio官网上的上述文档只给出了存在外部负载均衡的环境下查找ingress的对外IP和端口的方法，新装的环境并不具备外部负载均衡，因此还需要阅读第5篇的内容，使用不具备外部负载均衡环境下的相应手段找到对外IP和端口。&lt;/p&gt;

&lt;h3 id=&#34;三-实施&#34;&gt;三、实施&lt;/h3&gt;

&lt;p&gt;步骤一：任选1台VPS部署Master节点。命令的流水账如下：&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;systemctl stop firewalld
systemctl disable firewalld

cat &amp;lt;&amp;lt;EOF &amp;gt;  /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
EOF
sysctl --system

setenforce 0

swapoff -a

yum update

yum install -y docker
systemctl enable docker &amp;amp;&amp;amp; systemctl start docker

cat &amp;lt;&amp;lt;EOF &amp;gt; /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64
enabled=1
gpgcheck=1
repo_gpgcheck=1
gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
EOF
yum install -y kubelet kubeadm kubectl
systemctl enable kubelet &amp;amp;&amp;amp; systemctl start kubelet

kubeadm init --pod-network-cidr=10.244.0.0/16

export KUBECONFIG=/etc/kubernetes/admin.conf

kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/v0.9.1/Documentation/kube-flannel.yml

kubectl get pods --all-namespaces
kubectl get nodes
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;步骤二：在剩下的2台VPS上分别部署Slave节点。2台的命令相同，流水账如下：&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;systemctl stop firewalld
systemctl disable firewalld

cat &amp;lt;&amp;lt;EOF &amp;gt;  /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
EOF
sysctl --system

setenforce 0

swapoff -a

yum update

yum install -y docker
systemctl enable docker &amp;amp;&amp;amp; systemctl start docker

cat &amp;lt;&amp;lt;EOF &amp;gt; /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64
enabled=1
gpgcheck=1
repo_gpgcheck=1
gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
EOF
yum install -y kubelet kubeadm kubectl
systemctl enable kubelet &amp;amp;&amp;amp; systemctl start kubelet

kubeadm join --token cb320d.dffffef06d409d96 45.32.130.55:6443 --discovery-token-ca-cert-hash sha256:83a5715933843b4ad623414bea22c9d710851c276b2020906b3a38ddf924480f
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;步骤三：在Master节点上部署Istio，运行BookInfo示例。命令的流水账如下：&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;curl -L https://git.io/getLatestIstio | sh -

cd istio-0.4.0

kubectl apply -f install/kubernetes/istio-auth.yaml
kubectl apply -f install/kubernetes/istio-auth.yaml
kubectl apply -f install/kubernetes/istio-initializer.yaml
kubectl apply -f install/kubernetes/istio-initializer.yaml
kubectl get svc -n istio-system
kubectl get pods -n istio-system

kubectl create -f samples/bookinfo/kube/bookinfo.yaml
kubectl get services
kubectl get pods

kubectl -n istio-system get po -l istio=ingress -o jsonpath=&#39;{.items[0].status.hostIP}&#39;
kubectl -n istio-system get svc istio-ingress
curl -o /dev/null -s -w &amp;quot;%{http_code}\n&amp;quot; http://45.77.185.209:32384/productpage

kubectl create -f samples/bookinfo/kube/route-rule-all-v1.yaml
kubectl create -f samples/bookinfo/kube/route-rule-reviews-test-v2.yaml
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;四-验证&#34;&gt;四、验证&lt;/h3&gt;

&lt;p&gt;在浏览器中访问部署过程最后得到的URL：http://{host:port}/productpage，可以看见画面，并可在此画面确认针对不同版本的Reviews的请求路由效果。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>快速搭建Istio环境</title>
      <link>http://www.staytruestayfree.com/post/deploy_istio_quickly/</link>
      <pubDate>Fri, 26 Jan 2018 18:15:16 +0800</pubDate>
      
      <guid>http://www.staytruestayfree.com/post/deploy_istio_quickly/</guid>
      <description>

&lt;h3 id=&#34;问题域&#34;&gt;【问题域】&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;任务：搭建一个Istio的Bookinfo Sample&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;约束：搭建成果要求公网可访问可确认&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;资源：三个晚上的时间，一个Vultr账号，一台MacBook Pro&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;​&lt;/p&gt;

&lt;h3 id=&#34;解决域&#34;&gt;【解决域】&lt;/h3&gt;

&lt;h3 id=&#34;一-选型&#34;&gt;一、选型&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;基于Kubernetes以外的平台&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;和Kubernetes平台比各方面未见优势，不考虑&lt;/p&gt;

&lt;p&gt;​&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;基于在MacBook Pro上搭建的Minikube&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;公开到公网还需要花生壳等的支持，硬件有限时间更有限，或许可行，先不考虑&lt;/p&gt;

&lt;p&gt;​&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;基于在Vultr上Creating Kubernetes from Scratch（2-3节点）&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;此方案最能匹配进行该任务的初衷（学习Kubernetes搭建），但步骤较多时间不够，NG&lt;/p&gt;

&lt;p&gt;​&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;基于在Vultr上使用kubeadm搭建的Kubernetes集群&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;步骤不多，时间上或许可行，可作为备选方案&lt;/p&gt;

&lt;p&gt;​&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;在Google Cloud Platform 上搭建Kubernetes + Istio&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;一站式解决，步骤最少，自带免费服务器资源，选为首选方案&lt;/p&gt;

&lt;p&gt;​&lt;/p&gt;

&lt;h3 id=&#34;二-实施&#34;&gt;二、实施&lt;/h3&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;到Istio官网找到&lt;a href=&#34;https://istio.io/docs/setup/kubernetes/quick-start-gke-dm.html&#34;&gt;Quick Start with Google Kubernetes Engine&lt;/a&gt;作为整个实施过程的指南资料。&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;到&lt;a href=&#34;https://cloud.google.com/free/?hl=zh-cn&#34;&gt;Google Cloud Platform&lt;/a&gt;，注册账号，提交信用卡信息，获取$300的一年免费资源。&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;虽然申请成功，但付款设置里的结算信用卡账号被冻结，需要向谷歌在线申诉，申诉填写的内容很简单，但需要上传身份证/护照照片和信用卡正面照片（卡号用手指遮挡只露出4位尾号即可），一天内得到邮件回复信用卡账号解冻。（信用卡账号冻结的情况网上也有反映，我申请免费资源时收到了$1的信用卡支付失败短信，我怀疑跟我使用海外IP使用信用卡有关，抑或是银行针对性的封锁。）&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;到&lt;a href=&#34;https://console.cloud.google.com/apis/library/container.googleapis.com/&#34;&gt;Google Container Engine API&lt;/a&gt;打开对此API的使用（使用获赠的免费资源）。&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;到&lt;a href=&#34;https://console.cloud.google.com/iam-admin/iam/project&#34;&gt;Cloud Console&lt;/a&gt;，找到Compute Engine default service account（账号格式为projectNumber-compute@developer.gserviceaccount.com），对此账号在缺省的Editor角色外添加Kubernetes Engine Admin角色。&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;到&lt;a href=&#34;https://accounts.google.com/signin/v2/identifier?service=cloudconsole&amp;amp;continue=https://console.cloud.google.com/launcher/config?templateurl=https://raw.githubusercontent.com/istio/istio/master/install/gcp/deployment_manager/istio-cluster.jinja&amp;amp;followup=https://console.cloud.google.com/launcher/config?templateurl=https://raw.githubusercontent.com/istio/istio/master/install/gcp/deployment_manager/istio-cluster.jinja&amp;amp;flowName=GlifWebSignIn&amp;amp;flowEntry=ServiceLogin&#34;&gt;Istio GKE Deployment Manager&lt;/a&gt;安装Kubernetes + Istio + BookInfo，按照官网的说法，直接使用缺省设置Deploy即可。&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;但直接使用缺省设置Deploy，安装过程中会报*Quota &amp;lsquo;CPUS&amp;rsquo; exceeded. Limit: 8.0*的错。这是因为免费资源在一个Zone最多只提供8 cpus的资源，安装过程中不够用（安装过程中要使用比最终占用的更多的cpus）。解决办法是把*Node Machine Type*从缺省的2 vCPU改小为1 vCPU。（因为官网说使用GKE搭BookInfo至少要4个nodes，所以我们不改变缺省的&lt;em&gt;Number of GKE nodes to run on&lt;/em&gt; = 4）&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;安装过程中还遇到了部署waiter超时的错误，最终安装成功的版本的设置为：在步骤7的设置以外，把缺省设置中除*Add BookInfo Sample Application*以外的其它可选模块都不选了，但也许该错误与选择的模块无关，即使都选也可以成功（未经验证）。&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;在&lt;a href=&#34;https://console.cloud.google.com/kubernetes?_ga=2.200621287.893168199.1516952438-232307664.1502076417&#34;&gt;Google Kubernetes Engine Console&lt;/a&gt; 的上部标题栏中，点击*Activate Google Cloud Shell*图标启动gcloud的在线控制台。图标位置参见&lt;img src=&#34;https://cloud.google.com/shell/docs/images/startcloudshell1.png&#34; alt=&#34;示意图&#34; /&gt;。&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;在gcloud控制台中，执行以下命令：&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;gcloud container clusters list
gcloud container clusters get-credentials istio-cluster --zone=us-central1-a
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;在gcloud控制台中，执行以下命令：&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;kubectl get deployments,ing
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;在命令执行后输出的信息中，找到ADDRESS和PORTS，此即为公网上访问BookInfo Sample的IP和端口。&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;访问http://&lt;em&gt;ADDRESS:PORTS&lt;/em&gt;/productpage即可看到BookInfo Sample的页面，其中的*ADDRESS:PORTS*替换为上一步中得到的信息。&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;使用完成后，可在Google Cloud的&lt;a href=&#34;https://console.cloud.google.com/deployments&#34;&gt;部署管理器&lt;/a&gt;中删除所有已部署的环境。&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&#34;致谢&#34;&gt;致谢&lt;/h3&gt;

&lt;p&gt;感谢王老师！
于这凋敝，犬儒，浮虚的园子里，
久违了，真战士！&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Cache-Aside模式</title>
      <link>http://www.staytruestayfree.com/post/cdp-cache-aside-pattern/</link>
      <pubDate>Mon, 13 Feb 2017 16:24:14 +0800</pubDate>
      
      <guid>http://www.staytruestayfree.com/post/cdp-cache-aside-pattern/</guid>
      <description>

&lt;h2 id=&#34;原文-https-msdn-microsoft-com-en-us-library-dn589799-aspx&#34;&gt;&lt;a href=&#34;https://msdn.microsoft.com/en-us/library/dn589799.aspx&#34;&gt;原文&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://msdn.microsoft.com/en-us/library/dn600216.aspx&#34;&gt;&lt;img src=&#34;http://www.staytruestayfree.com/img/cloud-design-patterns/icons/data-management.png&#34; alt=&#34;Data Management&#34; title=&#34;Data Management&#34; /&gt;&lt;/a&gt;
&lt;a href=&#34;https://msdn.microsoft.com/en-us/library/dn600224.aspx&#34;&gt;&lt;img src=&#34;http://www.staytruestayfree.com/img/cloud-design-patterns/icons/performance-and-scalability.png&#34; alt=&#34;Performance &amp;amp; scalability.png&#34; title=&#34;Performance &amp;amp; scalability.png&#34; /&gt;&lt;/a&gt;
&lt;a href=&#34;https://msdn.microsoft.com/en-us/library/dn600223.aspx&#34;&gt;&lt;img src=&#34;http://www.staytruestayfree.com/img/cloud-design-patterns/icons/design-patterns.png&#34; alt=&#34;Design Patterns&#34; title=&#34;Design Patterns&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;在需要时从数据存储（data store）往缓存加载数据。这种模式可以提高性能，并有助于保持缓存与数据存储间的数据一致性。&lt;/p&gt;

&lt;h2 id=&#34;背景和问题&#34;&gt;背景和问题&lt;/h2&gt;

&lt;p&gt;应用程序使用缓存，以优化对数据存储中的信息的反复访问。但如果期望缓存与数据存储中的数据总是完全一致，通常却是不切实际的。应用程序需要实施这样一种策略，一方面确保在缓存中的数据是尽可能的最新状态，另一方面当缓存中的数据过期时，要能够对其察知和处理。&lt;/p&gt;

&lt;h2 id=&#34;解决方案&#34;&gt;解决方案&lt;/h2&gt;

&lt;p&gt;许多商业缓存系统提供read-through和write-though/write-behind操作。（译者注：关于xxx-aside/though/behind这些晦涩的用语，请参考&lt;a href=&#34;http://www.alachisoft.com/resources/articles/readthru-writethru-writebehind.html&#34;&gt;Using Read-through &amp;amp; Write-through in Distributed Cache&lt;/a&gt;和&lt;a href=&#34;https://en.wikipedia.org/wiki/Cache_memory&#34;&gt;Cache memory&lt;/a&gt;。）在这些系统中，应用程序通过引用缓存获取数据。如果数据不在缓存中，数据会被透明地从数据存储中取得并添加到缓存中。对缓存中的数据的任何修改也都会被自动写回到数据存储中。&lt;/p&gt;

&lt;p&gt;对于那些不提供上述功能的缓存，对缓存中数据的维护工作就成为了使用缓存的应用程序的职责。&lt;/p&gt;

&lt;p&gt;一个应用程序可以通过实现Cache-Aside策略来模拟read-through缓存的功能。该策略高效地将数据按需载入缓存。图1总结了这一过程的各个步骤。&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://www.staytruestayfree.com/img/cloud-design-patterns/cache-aside-pattern/figure-1.png&#34; alt=&#34;图1 - 使用Cache-Aside模式在缓存中存储数据&#34; title=&#34;图1 - 使用Cache-Aside模式在缓存中存储数据&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;图1 - 使用Cache-Aside模式在缓存中存储数据&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;如果一个应用程序要更新信息，它可以按照如下步骤来模拟write-through策略：&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;修改数据存储中的数据。&lt;/li&gt;
&lt;li&gt;将缓存中的相应项目置为无效。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;当下一次需要使用该项目时，根据Cache-Aside策略，应用程序会从数据存储中取得更新后的数据，并将其添加回缓存。&lt;/p&gt;

&lt;h2 id=&#34;问题和注意事项&#34;&gt;问题和注意事项&lt;/h2&gt;

&lt;p&gt;在决定如何实施这一模式时，请考虑以下几点：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;缓存数据的生命周期&lt;/strong&gt;。许多缓存实现了一个过期策略，根据过期策略，如果缓存中的数据持续一段规定的期限没有被访问，相应数据就会被置为无效，并被从缓存中删除。为了Cache-Aside模式的高效实施，需要确保过期策略与使用数据的应用程序的访问模式相匹配。不要使有效期限太短，因为这会导致应用程序不断地从数据存储中获取数据并把它添加到缓存。同样，不要使有效期限太长，因为这会导致缓存数据容易变得陈旧。请记住，针对相对静态的数据，或者频繁被读取的数据，缓存才是最有效的。&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;strong&gt;清除数据&lt;/strong&gt;。相对于作为数据源头的数据存储来说，大部分缓存只具备有限的数据容量，并且在必要时缓存将会清除数据。大多数缓存采用了最少最近使用（least-recently-used）策略来选择要清除的对象项目，但清除策略是可定制的。请配置缓存的全局过期属性和其它属性，以及每个缓存项目的过期属性，以帮助确保缓存在成本上是高效的。而对缓存中的所有项目都施加一个全局清除策略可能不总是适当的。例如，如果从数据存储中获取一个缓存项目的开销非常大，那么如下策略可能会更为有利：在缓存中保持这一获取开销巨大的项目，为此而清除那些更频繁被访问但获取开销更小的项目。&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;strong&gt;预装缓存&lt;/strong&gt;。许多解决方案在启动处理中，会用那些可能会被应用程序需要的数据来预填充缓存。如果发生某些数据过期或被清除的情况，Cache-Aside模式可能仍然是有用的。&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;strong&gt;一致性&lt;/strong&gt;。实现Cache-Aside模式不保证数据存储和缓存之间的一致性。在数据存储中的项目可在任何时间被一个外部进程来改变，而这种改变可能直到下一次该项目被载入缓存时才能在缓存中被反映。在跨数据存储复制数据的系统中，如果同步发生得非常频繁，这个问题可能会变得特别尖锐。&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;strong&gt;本地（内存内）缓存&lt;/strong&gt;。对一个应用程序实例来说，缓存可以是本地的，存储在内存中。如果一个应用程序反复访问相同的数据，Cache-Aside模式在这样的环境中是有用的。然而，本地缓存是私有的，因此对于相同的缓存数据，不同应用程序实例可能各自拥有它的一个副本。数据在各个缓存间可能很快就变得不一致了，因此可能需要更为频繁的使私有缓存中的数据过期并对其刷新。在这些场景下，可能适合于考虑使用共享式或分布式缓存机制。&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;何时使用这种模式&#34;&gt;何时使用这种模式&lt;/h2&gt;

&lt;p&gt;使用此模式时：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;缓存不提供原生的read-through和write-through操作。&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;资源需求是不可预测的。这种模式使应用程序能够按需加载数据。对于应用程序需要哪些数据，它不提前做任何假设。&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;这种模式可能不适合：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;当缓存的数据集是静态的。如果这样的数据能够被放入可用的缓存空间，那么请在启动中预装入这些数据，并对其实施数据不会过期的策略。&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;对于在署在Web服务器群（web farm）上的Web应用程序的会话状态信息的缓存。在这种环境下，你应该避免引入基于客户端—服务器关系的依赖。&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;示例&#34;&gt;示例&lt;/h2&gt;

&lt;p&gt;在Windows Azure中，你可以使用Windows Azure Cache来创建一个可供多个应用程序实例共享的分布式缓存。下面的代码示例中的GetMyEntityAsync方法展示了Cache-Aside模式基于Windows Azure Cache的一个实现。该方法使用read-though方式从缓存获取一个对象。&lt;/p&gt;

&lt;p&gt;一个对象通过使用一个整数ID作为Key来唯一标识。GetMyEntityAsync方法基于此Key生成一个字符串值（Windows Azure Cache的API使用字符串作为Key值），并尝试使用该Key从缓存中获取相匹配的项目。如果该匹配项目被找到，则将其返回。如果在缓存中没有相应匹配项目，GetMyEntityAsync方法会从数据存储获取该对象，并把它添加到缓存，然后返回它（因为依赖于具体的数据存储实现，所以实际从数据存储取得数据的代码被省略了）。注意，为防止由于别处发生的更新导致的缓存数据陈旧，缓存项目被进行了过期设置的配置。&lt;/p&gt;

&lt;p&gt;C#&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;private DataCache cache;
...

public async Task&amp;lt;MyEntity&amp;gt; GetMyEntityAsync(int id)
{
  // 为本方法及其参数定义一个唯一的key
  var key = string.Format(&amp;quot;StoreWithCache_GetAsync_{0}&amp;quot;, id);
  var expiration = TimeSpan.FromMinutes(3);
  bool cacheException = false;

  try
  {
    // 尝试从缓存取得实体数据
    var cacheItem = cache.GetCacheItem(key);
    if (cacheItem != null)
    {
      return cacheItem.Value as MyEntity;
    }
  }
  catch (DataCacheException)
  {
    // 如果发生缓存相关问题
    // 则抛出异常以避免在本次调用中的后续处理中使用缓存
    cacheException = true;
  }

  // 如果缓存未命中，则从原始的存储中取得实体数据并对其缓存
  // 因为依赖于具体数据存储的实现，此处的代码被省略了
  var entity = ...;

  if (!cacheException)
  {
    try
    {
      // 避免缓存null值
      if (entity != null)
      {
        // 把该项目放入缓存，并对其设置一个定制的过期时间 
        // 设置的过期时间的长短取决于数据变得陈旧的可能性的大小
        cache.Put(key, entity, timeout: expiration);
      }
    }
    catch (DataCacheException)
    {
      // 如果发生缓存相关问题
      // 忽略问题并直接返回实体数据
    }
  }

  return entity;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;注意：
示例使用了Windows Azure Cache API来访问存储和从缓存中取得信息。有关Windows Azure Cache API的更多信息，请参阅MSDN上的&lt;a href=&#34;http://msdn.microsoft.com/library/windowsazure/hh914165.aspx&#34;&gt;使用Windows Azure Cache&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;下面的UpdateEntityAsync方法展示了当其值被应用程序改变时，如何使缓存中的对象失效。这是一个write-through方式的例子。这段代码更新原始的数据存储（因为依赖于具体的数据存储实现，这部分功能的代码被省略了），然后通过指定Key调用Remove方法，从而在缓存中删除该缓存项目。&lt;/p&gt;

&lt;p&gt;注意：
在这个序列中，各步骤的顺序是重要的。如果相应项目在缓存被更新之前（译者注：此处为“在数据存储被更新之前”更为合理）就被删除，就会产生一个短暂的窗口期间，在此期间客户应用有可能在数据存储中的数据被更新之前取得该数据（因为没有在缓存中找到该数据），从而导致缓存中保存了陈旧的数据。&lt;/p&gt;

&lt;p&gt;C#&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;public async Task UpdateEntityAsync(MyEntity entity)
{
  // 更新原始数据存储中的对象
  await this.store.UpdateEntityAsync(entity).ConfigureAwait(false);

  // 取得被缓存对象的相应的Key
  var key = this.GetAsyncCacheKey(entity.Id);

  // 然后，使当前的缓存对象失效
  this.cache.Remove(key);
}

private string GetAsyncCacheKey(int objectId)
{
  return string.Format(&amp;quot;StoreWithCache_GetAsync_{0}&amp;quot;, objectId);
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;相关模式和指南&#34;&gt;相关模式和指南&lt;/h2&gt;

&lt;p&gt;实施这一模式时，以下模式和指南也可能是相关的：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&#34;https://msdn.microsoft.com/en-us/library/dn589802.aspx&#34;&gt;缓存指南&lt;/a&gt; 。针对在云解决方案中如何缓存数据，以及当你实现一个缓存时应该考虑的问题，该指南提供了额外的信息。&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;https://msdn.microsoft.com/en-us/library/dn589800.aspx&#34;&gt;数据一致性入门&lt;/a&gt; 。云应用程序通常使用的是分散在多个数据存储间的数据。在这样的环境中，管理和维护数据一致性可能会成为系统中的一个关键方面，特别是在那些能导致并发性和可用性问题的方面。该入门描述了在分布式存储的数据间产生的一致性问题，并总结了应用程序如何实现最终一致性，从而保持数据的可用性。&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;更多信息&#34;&gt;更多信息&lt;/h2&gt;

&lt;p&gt;MSDN上的文章&lt;a href=&#34;http://msdn.microsoft.com/library/windowsazure/hh914165.aspx&#34;&gt;使用Windows Azure Cache&lt;/a&gt;。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Git Bash HTTP代理设置</title>
      <link>http://www.staytruestayfree.com/post/git-bash-proxy/</link>
      <pubDate>Thu, 19 Jan 2017 15:20:23 +0800</pubDate>
      
      <guid>http://www.staytruestayfree.com/post/git-bash-proxy/</guid>
      <description>

&lt;h3 id=&#34;设定&#34;&gt;设定&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;git config --global http.proxy http://127.0.0.1:1080
git config --global https.proxy http://127.0.0.1:1080
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;&lt;em&gt;注意：有些例子把代理服务的URL用单引号括上，但在我的环境里带单引号的设置导致了错误。&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;h3 id=&#34;取消&#34;&gt;取消&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;git config --global --unset http.proxy
git config --global --unset https.proxy
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;查看&#34;&gt;查看&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;git config --global --get http.proxy
git config --global --get https.proxy
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;其它协议&#34;&gt;其它协议&lt;/h3&gt;

&lt;p&gt;HTTP仅仅是Git支持的协议之一。&lt;a href=&#34;https://git-scm.com/book/tr/v2/Git-on-the-Server-The-Protocols&#34;&gt;官网&lt;/a&gt;上如是说：&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Git can use four major protocols to transfer data: Local, HTTP, Secure Shell (SSH) and Git.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;有关SSH代理的设置，可以参考&lt;a href=&#34;https://kyonli.com/p/142&#34;&gt;这里&lt;/a&gt;。(未经验证)&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Hugo主题简介</title>
      <link>http://www.staytruestayfree.com/post/hugo-themes/</link>
      <pubDate>Thu, 19 Jan 2017 13:53:49 +0800</pubDate>
      
      <guid>http://www.staytruestayfree.com/post/hugo-themes/</guid>
      <description>

&lt;p&gt;目前Hugo官方一共提供了&lt;a href=&#34;https://themes.gohugo.io/&#34;&gt;135款主题（Themes）&lt;/a&gt;，下面归类简介其中的25款。&lt;br&gt;
挑选标准：3分代表性 + 6分个人喜好 + 1分随机 :p&lt;/p&gt;

&lt;h3 id=&#34;常规博客类&#34;&gt;常规博客类&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://themes.gohugo.io/heather-hugo/&#34;&gt;Heather Hugo&lt;/a&gt;：单列极简，源自Jekyll。 &lt;sup&gt;&lt;a href=&#34;http://themes.gohugo.io/theme/heather-hugo/&#34;&gt;&lt;em&gt;DEMO&lt;/em&gt;&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://themes.gohugo.io/beautifulhugo/&#34;&gt;Beautiful Hugo&lt;/a&gt;：单列黑白，源自Jekyll。&lt;sup&gt;&lt;a href=&#34;http://themes.gohugo.io/theme/beautifulhugo/&#34;&gt;&lt;em&gt;DEMO&lt;/em&gt;&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://themes.gohugo.io/darksimplicity/&#34;&gt;Dark Simplicity&lt;/a&gt;：单列黑暗。&lt;sup&gt;&lt;a href=&#34;http://themes.gohugo.io/theme/darksimplicity/&#34;&gt;&lt;em&gt;DEMO&lt;/em&gt;&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://themes.gohugo.io/startbootstrap-clean-blog/&#34;&gt;Startbootstrap Clean Blog&lt;/a&gt;：单列背景头部，源自Start Bootstrap。&lt;sup&gt;&lt;a href=&#34;http://themes.gohugo.io/theme/startbootstrap-clean-blog/&#34;&gt;&lt;em&gt;DEMO&lt;/em&gt;&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://themes.gohugo.io/hugo-dgraph-theme/&#34;&gt;Dgraph&lt;/a&gt;：单列一文一图。&lt;sup&gt;&lt;a href=&#34;http://themes.gohugo.io/theme/hugo-dgraph-theme/&#34;&gt;&lt;em&gt;DEMO&lt;/em&gt;&lt;/a&gt;&lt;/sup&gt; &lt;sup&gt;&lt;a href=&#34;https://open.dgraph.io/&#34;&gt;&lt;em&gt;LIVE&lt;/em&gt;&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://themes.gohugo.io/hyde&#34;&gt;Hyde&lt;/a&gt;：双列左边栏，基于base16可变换配色，源自Jekyll，hugo作者作品。&lt;sup&gt;&lt;a href=&#34;http://themes.gohugo.io/theme/hyde/&#34;&gt;&lt;em&gt;DEMO&lt;/em&gt;&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://themes.gohugo.io/hugo-bootstrap-premium/&#34;&gt;Hugo Bootstrap Premium&lt;/a&gt;：hyde系改版之一，功能多多，未提供demo。&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://themes.gohugo.io/hugo-geo/&#34;&gt;Hugo Geo&lt;/a&gt;：双列彩色左边栏。&lt;sup&gt;&lt;a href=&#34;http://themes.gohugo.io/theme/hugo-geo/&#34;&gt;&lt;em&gt;DEMO&lt;/em&gt;&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://themes.gohugo.io/twentyfourteen/&#34;&gt;Twenty Fourteen&lt;/a&gt;：双列黑白左边栏，源自WordPress。&lt;sup&gt;&lt;a href=&#34;http://themes.gohugo.io/theme/twentyfourteen/&#34;&gt;&lt;em&gt;DEMO&lt;/em&gt;&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://themes.gohugo.io/nixon/&#34;&gt;Nixon&lt;/a&gt;：双列黑白左边栏，hugo作者博客用同款。&lt;sup&gt;&lt;a href=&#34;http://themes.gohugo.io/theme/nixon/&#34;&gt;&lt;em&gt;DEMO&lt;/em&gt;&lt;/a&gt;&lt;/sup&gt; &lt;sup&gt;&lt;a href=&#34;http://spf13.com/&#34;&gt;&lt;em&gt;LIVE&lt;/em&gt;&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://themes.gohugo.io/hugo-octopress/&#34;&gt;Hugo Octopress&lt;/a&gt;：双列黑白右边栏，源自Octopress，定制文档详尽。&lt;sup&gt;&lt;a href=&#34;http://themes.gohugo.io/theme/hugo-octopress/&#34;&gt;&lt;em&gt;DEMO&lt;/em&gt;&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;特色设计类&#34;&gt;特色设计类&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://themes.gohugo.io/material-design/&#34;&gt;Material Design&lt;/a&gt;：贴纸风，material design。&lt;sup&gt;&lt;a href=&#34;http://themes.gohugo.io/theme/material-design/&#34;&gt;&lt;em&gt;DEMO&lt;/em&gt;&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://themes.gohugo.io/hugo-creative-portfolio-theme/&#34;&gt;Creative portfolio&lt;/a&gt;：贴纸风，源自Bootstrapious。&lt;sup&gt;&lt;a href=&#34;http://themes.gohugo.io/theme/hugo-creative-portfolio-theme/&#34;&gt;&lt;em&gt;DEMO&lt;/em&gt;&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://themes.gohugo.io/hugo-remark-minion/&#34;&gt;Remark Minion&lt;/a&gt;：基于remark.js的slides秀。&lt;sup&gt;&lt;a href=&#34;http://themes.gohugo.io/theme/hugo-remark-minion/&#34;&gt;&lt;em&gt;DEMO&lt;/em&gt;&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://themes.gohugo.io/Shapez-Theme/&#34;&gt;Shapez Theme&lt;/a&gt;：基于SVG,花哨。&lt;sup&gt;&lt;a href=&#34;http://themes.gohugo.io/theme/Shapez-Theme/&#34;&gt;&lt;em&gt;DEMO&lt;/em&gt;&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;特色实现类&#34;&gt;特色实现类&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://themes.gohugo.io/blank/&#34;&gt;Blank&lt;/a&gt;：空白theme，各种定制的起点。&lt;sup&gt;&lt;a href=&#34;http://themes.gohugo.io/theme/blank/&#34;&gt;&lt;em&gt;DEMO&lt;/em&gt;&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://themes.gohugo.io/light-hugo/&#34;&gt;Light Hugo&lt;/a&gt;：基于normalize.css(sass)，无javascript。&lt;sup&gt;&lt;a href=&#34;http://themes.gohugo.io/theme/light-hugo/&#34;&gt;&lt;em&gt;DEMO&lt;/em&gt;&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://themes.gohugo.io/future-imperfect/&#34;&gt;Hugo Future Imperfect&lt;/a&gt;：强化响应式布局，源自HTML5 UP 。&lt;sup&gt;&lt;a href=&#34;http://themes.gohugo.io/theme/future-imperfect/&#34;&gt;&lt;em&gt;DEMO&lt;/em&gt;&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://themes.gohugo.io/aglaus/&#34;&gt;Aglaus&lt;/a&gt;：AMP加速。&lt;sup&gt;&lt;a href=&#34;http://themes.gohugo.io/theme/aglaus/&#34;&gt;&lt;em&gt;DEMO&lt;/em&gt;&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;专用功能类&#34;&gt;专用功能类&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://themes.gohugo.io/landing-page-hugo/&#34;&gt;Landing Page&lt;/a&gt;：单列个人/企业展示，图文，源自Jekyll。&lt;sup&gt;&lt;a href=&#34;http://themes.gohugo.io/theme/landing-page-hugo/&#34;&gt;&lt;em&gt;DEMO&lt;/em&gt;&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://themes.gohugo.io/freelancer/&#34;&gt;Freelancer&lt;/a&gt;：单列个人/企业展示,彩色，源自Jekyll。&lt;sup&gt;&lt;a href=&#34;http://themes.gohugo.io/theme/freelancer/&#34;&gt;&lt;em&gt;DEMO&lt;/em&gt;&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://themes.gohugo.io/github-project-landing-page/&#34;&gt;Github project Page&lt;/a&gt;：开发项目主页用。&lt;sup&gt;&lt;a href=&#34;http://swiftline.github.io/&#34;&gt;&lt;em&gt;DEMO&lt;/em&gt;&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://themes.gohugo.io/material-docs/&#34;&gt;Material Docs&lt;/a&gt;：在线文档用，material design。&lt;sup&gt;&lt;a href=&#34;http://themes.gohugo.io/theme/material-docs/&#34;&gt;&lt;em&gt;DEMO&lt;/em&gt;&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://themes.gohugo.io/hugo-faq-theme/&#34;&gt;Hugo FAQ Theme&lt;/a&gt;：FAQ用。&lt;sup&gt;&lt;a href=&#34;http://themes.gohugo.io/theme/hugo-faq-theme/&#34;&gt;&lt;em&gt;DEMO&lt;/em&gt;&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://themes.gohugo.io/hugo-orbit-theme/&#34;&gt;Orbit&lt;/a&gt;：个人简历用。&lt;sup&gt;&lt;a href=&#34;http://themes.gohugo.io/theme/hugo-orbit-theme/&#34;&gt;&lt;em&gt;DEMO&lt;/em&gt;&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>First Post</title>
      <link>http://www.staytruestayfree.com/post/first/</link>
      <pubDate>Fri, 13 Jan 2017 09:48:13 +0800</pubDate>
      
      <guid>http://www.staytruestayfree.com/post/first/</guid>
      <description>&lt;p&gt;This is my first post, how exciting!&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>